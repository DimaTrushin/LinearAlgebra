\ProvidesFile{lecture19.tex}[Лекция 19]


\subsection{Структура векторного пространства с оператором}

Изучение структуры матрицы линейного оператора в некотором базисе равносильна изучению инвариантных подпространств пространства $V$.
Теорема о жордановой нормальной форме может рассматриваться таким образом как структурная теорема для векторного пространства с оператором.
В общем виде теорема о жордановой нормальной форме доказывается в два шага: все пространство раскладывается в прямую сумму корневых, после чего задача сводится к нильпотентному оператору.
Первый шаг мы уже на самом деле проделали в утверждении~\ref{claim::GenRootDec}.

\begin{claim}
\label{claim::RootSpaceDec}
Пусть $\varphi\colon V\to V$ -- линейный оператор такой, что его характеристический (или минимальный) многочлен раскладывается на линейные множители.
Тогда $V = V^{\lambda_1} \oplus \ldots\oplus V^{\lambda_r}$, где $\spec_F \varphi = \{\lambda_1,\ldots, \lambda_r\}$.
\end{claim}
\begin{proof}
Это частный случай утверждения~\ref{claim::GenRootDec}.
\end{proof}

\paragraph{Замечание}

Давайте объясним, что мы доказали на данный момент.
Пусть $\varphi\colon V\to V$ -- некоторый линейный оператор, у которого характеристический многочлен раскладывается на линейные множители.
Тогда $V = V^{\lambda_1}\oplus\ldots\oplus V^{\lambda_r}$.
Выберем базис $e_i$ в каждом $V^{\lambda_i}$.
Тогда по одному из определений прямой суммы $e = e_1 \sqcup \ldots \sqcup e_r$ будет базисом $V$.
Так как все $V^{\lambda_i}$ инвариантны относительно $\varphi$, то когда мы запишем его матрицу в этом базисе, мы получим блочно диагональную матрицу вида
\[
A_\varphi = 
\begin{pmatrix}
{A_1}&{}&{}&{}\\
{}&{A_2}&{}&{}\\
{}&{}&{\ddots}&{}\\
{}&{}&{}&{A_r}\\
\end{pmatrix}
\]
где $A_i$ -- это матрица ограничения $\varphi|_{V^{\lambda_i}}$, то есть ее размер равен $\dim V^{\lambda_i}$.
Кроме того, из утверждения~\ref{claim::OperatorUpperTriangle} следует, что в каждом $V^{\lambda_i}$ можно найти такой базис, что матрица $A_i$ будет верхне треугольной с числом $\lambda_i$ на диагонали, то есть
\[
A_i = 
\begin{pmatrix}
{\lambda_i}&{*}&{\ldots}&{*}\\
{}&{\lambda_i}&{\ldots}&{*}\\
{}&{}&{\ddots}&{\vdots}\\
{}&{}&{}&{\lambda_i}\\
\end{pmatrix}
\]
Наша цель еще улучшить вид матриц $A_i$.
Оказывается, почти все элементы верхнего блока можно сделать нулевыми.
Что это в точности означает и как доказывается, вы узнаете в теореме о жордановой нормальной форме.


\subsection{Отношение равенства по модулю подпространства}

\begin{definition}
Пусть $V$ -- векторное пространство, а $U\subseteq V$ -- подпространство.
Тогда будем говорить, что векторы $v,w\in V$ равны по модулю $U$ и писать $v = w \pmod U$, если $v - w \in U$.%
\footnote{На самом деле равенство по модулю подпространства сводится к равенству в некотором новом пространстве, которое называется фактор пространством.
Так как мы пока не знаем, что это такое, будем пользоваться лишь отношением равенства по модулю.
Думать про него надо так же, как и про остатки в целых числах.}
\end{definition}

Например, если $V = \mathbb R^2$ -- плоскость и $U = \langle e_1\rangle$ -- горизонтальная прямая, то все векторы лежащие на горизонтальных прямых между собой равны по модулю $U$.
Например, $e_2 = e_2 + e_1 = e_2 - 3 e_1 \pmod U$.
Но $e_2 \neq 2 e_2 \pmod U$.

Заметим, что обычное равенство -- это равенство по модулю нулевого подпространства.
С другой стороны, по модулю подпространства $U = V$ любые два вектора равны.

\begin{definition}
Пусть $V$ -- векторное пространство,  $U\subseteq V$ -- некоторое подпространство, и $v_1,\ldots,v_n\in V$ -- набор векторов.
\begin{enumerate}
\item Будем говорить, что $v_1,\ldots,v_n$ линейно независимы по модулю $U$, если из равенства $\alpha_1 v_1 + \ldots + \alpha_n v_n = 0 \pmod U$ следует, что $\alpha_1 = \ldots = \alpha_ n = 0$.

\item Будем говорить, что $v_1, \ldots, v_n$ порождающие по модулю $U$, если для любого вектора $v\in V$ найдутся коэффициенты $\alpha_1,\ldots,\alpha_n\in F$ такие, что $v = \alpha_1 v_1 + \ldots + \alpha_n v_n\pmod U$.

\item Будем говорить, что $v_1,\ldots,v_n$ являются базисом $V$ по модулю $U$, если они одновременно линейно независимы и порождающие по модулю $U$.%
\footnote{Так как равенство по модулю сводится к равенству в некотором новом пространстве, то все факты про базис аналогичные обычным фактам, что мы доказывали будут верны.
Вам же я предлагаю доказать их по аналогии в качестве упражнения.}
\end{enumerate}
\end{definition}

\begin{claim}
Пусть $V$ -- векторное пространство, $U\subseteq V$ -- подпространство, и $v_1,\ldots,v_n\in V$ -- набор векторов.
Тогда
\begin{enumerate}
\item Векторы $v_1,\ldots,v_n$ линейно независимы по модулю $U$ тогда и только тогда, когда они линейно независимы и $\langle v_1,\ldots,v_n \rangle \cap U = 0$.

\item Векторы $v_1, \ldots,v_n$ порождающие по модулю $U$ тогда и только тогда, когда $\langle v_1,\ldots,v_n\rangle + U = V$.

\item Векторы $v_1, \ldots,v_n$ являются базисом по модулю $U$ тогда и только тогда, когда они линейно независимы и $\langle v_1,\ldots,v_n\rangle \oplus U = V$.
\end{enumerate}
\end{claim}
\begin{proof}
(1) $\Rightarrow$ Пусть $\alpha_1v_1+\ldots+\alpha_n v_n = 0$, тогда $\alpha_1 v_1 + \ldots+ \alpha_n v_n \in U$.
Последнее означает, что $\alpha_1v_1 + \ldots+ \alpha_n v_n = 0 \pmod U$.
А значит все $\alpha_i = 0$.
Значит $v_i$ линейно независимы.
Теперь рассмотрим вектор $v\in \langle v_1,\ldots,v_n\rangle \cap U$.
Так как $v$ лежит в первом подпространстве, то $v = \alpha_1 v_1 + \ldots+\alpha_n v_n$.
Так как он лежит в правом подпространстве, то $\alpha_1 v_1 + \ldots+ \alpha_n v_n = v \in U$.
Значит $\alpha_1 v_1 + \ldots + \alpha_n v_n = 0\pmod U$.
А следовательно все $\alpha_i =0$.
Но значит и $v = 0$, что и требовалось.

$\Leftarrow$ Пусть $\alpha_1 v_1 +\ldots+\alpha_n v_n = 0 \pmod U$.
Это значит, что $\alpha_1 v_1 + \ldots + \alpha_n v_n \in U$.
А значит $\alpha_1 v_1 +\ldots + \alpha_n v_n \in \langle v_1,\ldots,v_n\rangle \cap U = 0$.
То есть $\alpha_1 v_1 + \ldots + \alpha_n v_n = 0$.
Но так как $v_i$ линейно независимы, то $\alpha_i = 0$ для всех $i$.

(2) $\Rightarrow$ По определению, для любого $v\in V$ найдутся коэффициенты $\alpha_i$ такие, что $v = \alpha_1 v_1 + \ldots + \alpha_n v_n \pmod U$.
То есть $v - (\alpha_1 v_1 + \ldots + \alpha_n v_n) = u \in U$.
Значит, $v = \alpha_1 v_1 + \ldots + \alpha_n v_n + u$, что и требовалось.

$\Leftarrow$ Пусть $v\in V = \langle v_1, \ldots, v_n \rangle + U$.
Тогда $v = \alpha_1 v_1 + \ldots + \alpha_n v_n + u$.
По определению это означает, что $v = \alpha_1 v_1 + \ldots + \alpha_n v_n \pmod U$.

(3) Этот пункт получается из первых двух вместе взятых.
\end{proof}

\subsection{Жорданова нормальная форма для нильпотентных операторов}

\begin{definition}
\label{def::JNF}
Матрица 
\[
J_n(\lambda) = 
\begin{pmatrix}
{\lambda}&{1}&{}&{}&{}\\
{}&{\lambda}&{1}&{}&{}\\
{}&{}&{\ddots}&{\ddots}&{}\\
{}&{}&{}&{\lambda}&{1}\\
{}&{}&{}&{}&{\lambda}\\
\end{pmatrix}
\in \operatorname{M}_n(F)
\]
называется жордановой клеткой размера $n$.
Если матрица $A$ блочно диагональная, где на диагонали стоят жордановы клетки
\[
A = 
\begin{pmatrix}
{J_{n_1}(\lambda_1)}&{}&{}&{}\\
{}&{J_{n_2}(\lambda_2)}&{}&{}\\
{}&{}&{\ddots}&{}\\
{}&{}&{}&{J_{n_r}(\lambda_r)}\\
\end{pmatrix}
\in \operatorname{M}_{n_1 + \ldots + n_r}(F)
\]
то говорят, что $A$ имеет жорданову нормальную форму.
\end{definition}

Рассмотрим оператор $\phi\colon F^n \to F^n$, по правилу $x\mapsto J_n(0)x$.
Если $e_1, \ldots ,e_n$ -- стандартный базис в $F^n$, то мы видим, что 
\[
0\stackrel{\phi}{\longleftarrow}e_1\stackrel{\phi}{\longleftarrow}e_2 \stackrel{\phi}{\longleftarrow}\ldots\stackrel{\phi}{\longleftarrow}e_{n-1}\stackrel{\phi}{\longleftarrow}e_n
\]
Наоборот, пусть у нас нашелся базис для оператора $\phi\colon V\to V$ с таким свойством.
Тогда метод пристального взгляда нам подсказывает, что его матрица в этом базисе будет $J_n(0)$.
Таким образом мы описали на геометрическом языке как понять, что в некотором базисе матрица оператора задана жордановой клеткой с нулем на диагонали.

\begin{claim}
\label{claim::LinIndepModKer}
Пусть $\varphi\colon V\to V$ -- некоторый оператор и $v_1,\ldots,v_r\in \ker \varphi^{k+1}$ линейно независимы по модулю $\ker \varphi^k$.
Тогда векторы $\varphi v_1,\ldots,\varphi v_r$ лежат в $\ker \varphi^k$ и при $k \geqslant 1$%
\footnote{При $k = 0$ все векторы $\varphi v_i = 0$.
Формально доказательство не сработает, так как при $k = 0$ не определено $\ker \varphi^{0 - 1}$.}
они линейно независимы по модулю $\ker \varphi^{k-1}$.
\end{claim}
\begin{proof}
Тот факт что $\varphi v_i\in \ker \varphi^{k}$ следует из того, что они зануляются оператором $\varphi^k$.
Теперь покажем, что они линейно независимы по модулю $\ker \varphi^{k-1}$.
Пусть 
\[
\alpha_1 \varphi v_1 + \ldots + \alpha_r \varphi v_r = 0 \pmod{\ker \varphi^{k-1}}
\]
Тогда
\begin{gather*}
\varphi(\alpha_1 v_1 + \ldots + \alpha_r v_r)\in \ker \varphi^{k-1}\Rightarrow\\
\varphi^k(\alpha_1 v_1 + \ldots + \alpha_r v_r) = 0\Rightarrow\\
\alpha_1v_1 +\ldots + \alpha_r v_r \in \ker\varphi^k\Rightarrow\\
\alpha_1 v_1 + \ldots + \alpha_r v_r = 0 \pmod{\ker \varphi^k}
\end{gather*}
Значит все $\alpha_i = 0$, что и требовалось.
\end{proof}

\begin{claim}
[ЖНФ для нильпотентов]
\label{claim::NilJNF}
Пусть $\varphi\colon V\to V$ -- нильпотентный оператор.
Тогда
\begin{enumerate}
\item Для оператора $\varphi$ существует жорданов базис, то есть в некотором базисе матрица $\varphi$ имеет вид
\[
A_\varphi = 
\begin{pmatrix}
{J_{n_1}(0)}&{}&{}&{}\\
{}&{J_{n_2}(0)}&{}&{}\\
{}&{}&{}&{}\\
{}&{}&{}&{J_{n_r}(0)}\\
\end{pmatrix}
\]

\item Количество клеток размера $r$ вычисляется по формуле
\[
2\dim \ker \varphi^r - \dim \ker \varphi^{r+1} - \dim \ker \varphi^{r-1}
\]
Так как эти числа не зависят от базиса, то в любом жордановом базисе количество клеток размера $r$ одинаковое.
А значит жордановы формы в разных базисах могут отличаться лишь перестановкой клеток.
\end{enumerate}
\end{claim}
\begin{proof}
(1) Пусть $\varphi^k = 0$, причем $k$ -- наименьшее возможное.
Для того, чтобы доказать теорему, мне надо найти базис в пространстве $V = \ker \varphi^k$, состоящий из цепочек вида:
\[
0\stackrel{\varphi}{\longleftarrow}e_1\stackrel{\varphi}{\longleftarrow}e_2 \stackrel{\varphi}{\longleftarrow}\ldots\stackrel{\varphi}{\longleftarrow}e_{n-1}\stackrel{\varphi}{\longleftarrow}e_n
\]
Каждая такая цепочка будет давать одну клетку размера $n$.
Так как вектор $e_n$ в такой цепочке имеет высоту $n$ его надо искать в $\ker \varphi^{n}\setminus\ker\varphi^{n-1}$.
Значит, чтобы получить самые длинные цепочки я должен как-то выбрать векторы $v_1,\ldots, v_r$ в $\ker\varphi^k \setminus \ker \varphi^{k-1}$.
При этом, я хочу, чтобы все векторы вида $\varphi^i v_j$ были между собой линейно независимы.
То есть выбирать надо аккуратно.
Для этого мне и понадобится понятие линейной независимости по модулю подпространства.
Итак, приступим.

Возьмем $v_1,\ldots,v_{r_1}\in\ker\varphi^k$ -- базис $\ker \varphi^k$ по модулю $\ker \varphi^{k-1}$.
Последнее означает, что $\ker \varphi^k = \langle v_1,\ldots,v_{r_1}\rangle \oplus \ker \varphi^{k-1}$.
Из утверждения~\ref{claim::LinIndepModKer} следует, что векторы $\varphi v_1,\ldots,\varphi v_{r_1}$ лежат в $\ker \varphi^{k-1}$ и линейно независимы по модулю $\ker \varphi^{k-2}$.%
\footnote{Либо, что $k = 1$, то есть $V = \ker \varphi$, а значит $\varphi = 0$ и доказывать нечего.}
Значит их можно дополнить до базиса пространства $\ker \varphi^{k-1}$ по модулю подпространства $\varphi^{k-2}$ векторами $v_{r_1+1},\ldots,v_{r_2}$.
Данный процесс можно изобразить на следующей диаграмме:
\[
\xymatrix@R=15pt@C=15pt{
  {\ker \varphi^k}&
  {v_1}\ar@{|->}[d]&{\ldots}&{v_{r_1}}\ar@{|->}[d]&
  {}&{}&{}\\
  {\ker \varphi^{k-1}}\ar@{}[u]|{\cup}&
  {\varphi v_1}&{\ldots}&{\varphi v_{r_1}}&
  {v_{r_1 + 1}}&{\ldots}&{v_{r_2}}\\
}
\]
Кроме того, проделанное означает, что 
\begin{gather*}
\ker \varphi^k = \langle v_1,\ldots, v_{r_1}\rangle \oplus \ker \varphi^{k-1}\\
\ker \varphi^{k-1} = \langle \varphi v_1,\ldots, \varphi v_{r_1}\rangle \oplus \langle v_{r_1 + 1},\ldots,v_{r_2}\rangle \oplus \ker \varphi^{k-2}
\end{gather*}
Мы можем продолжать этот процесс далее.
Он остановится, когда мы дойдем до $\ker \varphi$, так как следующее подпространство будет уже нулевым.
Весь процесс можно изобразить на следующей диаграмме (здесь я векторы обозначил точками, чтобы не загромождать обозначения):
\[
\xymatrix@R=15pt@C=15pt{
  {\ker\varphi^k}&{\bullet}\ar[d]
%  {\save
%   [].[rrr]*[F-:<3pt>]\frm{}
%  \restore}
  {\save
   [].[rrr]*+[F--]\frm{}
  \restore}
  &
  {\bullet}\ar[d]&{\ldots}&{\bullet}\ar[d]&
  {}&{}&{}&
  {}&
  {}&{}&{}&
  {}&{}&{}\\
  {\ker\varphi^{k-1}}\ar@{}[u]|{\cup}&{\bullet}\ar[d]
  {\save
   [].[rrrrrr]*+[F--]\frm{}
  \restore}
  &
  {\bullet}\ar[d]&{\ldots}&{\bullet}\ar[d]&
  {\bullet}\ar[d]
%  {\save
%   [].[rr]*[F-:<3pt>]\frm{}
%  \restore}
  &{\ldots}&{\bullet}\ar[d]&
  {}&
  {}&{}&{}&
  {}&{}&{}\\
  {\vdots}\ar@{}[u]|{\cup}&
  {\vdots}\ar[d]&{\vdots}\ar[d]&{\vdots}&{\vdots}\ar[d]&
  {\vdots}\ar[d]&{\vdots}&{\vdots}\ar[d]&
  {\ddots}&
  {}&{}&{}&
  {}&{}&{}\\
  {\ker\varphi^2}\ar@{}[u]|{\cup}&{\bullet}\ar[d]
  {\save
   [].[rrrrrrrrrr]*+[F--]\frm{}
  \restore}
  &
  {\bullet}\ar[d]&{\ldots}&{\bullet}\ar[d]&
  {\bullet}\ar[d]&{\ldots}&{\bullet}\ar[d]&
  {\ldots}&
  {\bullet}\ar[d]
%  {\save
%   [].[rr]*[F-:<3pt>]\frm{}
%  \restore}
  &{\ldots}&{\bullet}\ar[d]&
  {}&{}&{}\\
  {\ker\varphi}\ar@{}[u]|{\cup}&{\bullet}\ar[d]
  {\save
   [].[rrrrrrrrrrrrr]*+[F--]\frm{}
  \restore}
  &
  {\bullet}\ar[d]&{\ldots}&{\bullet}\ar[d]&
  {\bullet}\ar[d]&{\ldots}&{\bullet}\ar[d]&
  {\ldots}&
  {\bullet}\ar[d]&{\ldots}&{\bullet}\ar[d]&
  {\bullet}\ar[d]
%  {\save
%   [].[rr]*[F-:<3pt>]\frm{}
%  \restore}
  &{\ldots}&{\bullet}\ar[d]\\
  {0}\ar@{}[u]|{\cup}&
  {0}&{0}&{\ldots}&{0}&
  {0}&{\ldots}&{0}&
  {\ldots}&
  {0}&{\ldots}&{0}&
  {0}&{\ldots}&{0}\\
}
\]
Кроме того, мы будем иметь равенства вида:
\[
\ker \varphi^{k-s} = \langle \varphi^s v_1,\ldots,\varphi^s v_{r_1}\rangle \oplus \langle \varphi^{s-1}v_{r_1 + 1},\ldots,\varphi^{s-1}v_{r_2}\rangle \oplus \ldots \oplus \langle v_{r_s + 1},\ldots,v_{r_{s+1}} \rangle \oplus \ker \varphi^{k - s -1}
\]
То есть все векторы расположенные в заштрихованных прямоугольниках на диаграмме выше являются линейно независимыми между собой и со всеми векторами, которые лежат ниже них.
Значит все построенные вектора (точки на диаграмме выше) являются базисом пространства $\ker \varphi^k = V$.
А это то, что и надо было сделать.

(2) Теперь нам надо доказать формулу для количества клеток.
Для этого предлагается сделать так: выберем произвольную жорданову нормальную форму для оператора, для нее посчитаем количество клеток фиксированного размера и поймем, что оно задается нужной формулой.
Пусть $e_1,\ldots,e_n$ -- жорданов базис и пусть матрица оператора имеет вид
\[
A =
\begin{pmatrix}
{J_{k_1}(0)}&{}&{}&{}\\
{}&{J_{k_2}(0)}&{}&{}\\
{}&{}&{\ddots}&{}\\
{}&{}&{}&{J_{k_s}(0)}\\
\end{pmatrix}
\]
Переставив базисные векторы, мы можем считать, что $k_1 \geqslant k_2 \geqslant\ldots\geqslant k_s$.
Тогда мы можем расположить базисные векторы в виде диаграммы
\[
\xymatrix@R=15pt@C=15pt{
  {e_k}\ar[d]
  {\save
   [].[rrr]*[F-:<3pt>]\frm{}
  \restore}
  {\save
   [].[rrr]*+[F--]\frm{}
  \restore}&
  {\bullet}\ar[d]&{\ldots}&{\bullet}\ar[d]&
  {}&{}&{}&
  {}&
  {}&{}&{}&
  {}&{}&{}\\
  {e_{k-1}}\ar[d]
  {\save
   [].[rrrrrr]*+[F--]\frm{}
  \restore}&
  {\bullet}\ar[d]&{\ldots}&{\bullet}\ar[d]&
  {\bullet}\ar[d]
  {\save
   [].[rr]*[F-:<3pt>]\frm{}
  \restore}&{\ldots}&{\bullet}\ar[d]&
  {}&
  {}&{}&{}&
  {}&{}&{}\\
  {\vdots}\ar[d]&{\vdots}\ar[d]&{\vdots}&{\vdots}\ar[d]&
  {\vdots}\ar[d]&{\vdots}&{\vdots}\ar[d]&
  {\ddots}&
  {}&{}&{}&
  {}&{}&{}\\
  {e_2}\ar[d]
  {\save
   [].[rrrrrrrrrr]*+[F--]\frm{}
  \restore}&
  {\bullet}\ar[d]&{\ldots}&{\bullet}\ar[d]&
  {\bullet}\ar[d]&{\ldots}&{\bullet}\ar[d]&
  {\ldots}&
  {\bullet}\ar[d]
  {\save
   [].[rr]*[F-:<3pt>]\frm{}
  \restore}&{\ldots}&{\bullet}\ar[d]&
  {}&{}&{}\\
  {e_1}\ar[d]
  {\save
   [].[rrrrrrrrrrrrr]*+[F--]\frm{}
  \restore}&
  {\bullet}\ar[d]&{\ldots}&{\bullet}\ar[d]&
  {\bullet}\ar[d]&{\ldots}&{\bullet}\ar[d]&
  {\ldots}&
  {\bullet}\ar[d]&{\ldots}&{\bullet}\ar[d]&
  {\bullet}\ar[d]
  {\save
   [].[rr]*[F-:<3pt>]\frm{}
  \restore}&{\ldots}&{e_n}\ar[d]\\
  {0}&{0}&{\ldots}&{0}&
  {0}&{\ldots}&{0}&
  {\ldots}&
  {0}&{\ldots}&{0}&
  {0}&{\ldots}&{0}\\
}
\]
где мы ставим вектора $e_1, e_2, \ldots, e_n$ снизу вверх и слева направо, а стрелочки означают применение оператора $\varphi$.
Теперь мы знаем, что все эти векторы линейно независимы, но вообще говоря не понятно, как они связаны с ядрами.
Давайте покажем, что нижние $r$ слоев дают базис $\ker \varphi^r$.
Действительно, рассмотрим произвольный вектор $v = a_1 e_1 + \ldots + a_n e_n$ из $\ker \varphi^r$.
Это значит, что $\varphi^r (v) = 0$.
Давайте мысленно расставим коэффициенты $a_i$ в диаграмме выше рядом с соответствующим $e_i$.
При применении $\varphi$  каждый базисный вектор спустится на ярус ниже, а вектора нижнего яруса занулятся.
Это значит, что под действием $\varphi^r$ нижние $r$ ярусов занулсятся, а вектора с ярусов $r+1, \ldots, k$ перейдут на ярусы $1,\ldots, k-r$.
Давайте изобразим это безобразие на следующем примере.%
\footnote{Здесь имеется в виду, что надо взять сумму всех указанных на диаграмме слагаемых.
Слева стоит исходная линейная комбинация $v = a_1 e_1 + \ldots + a_{13}e_{13}$, а справа результат применения к нему $\varphi^2$, то есть $\varphi^2v$.}
\[
\begin{aligned}[c]
\xymatrix@R=15pt@C=10pt{
	{a_4e_4}\ar[d]&{a_8e_8}\ar[d]&{}&{}&{}\\
	{a_3e_3}\ar[d]&{a_7e_7}\ar[d]&{a_{10}e_{10}}\ar[d]&{}&{}\\
	{a_2e_2}\ar[d]&{a_6e_6}\ar[d]&{a_9e_9}\ar[d]&{a_{12}e_{12}}\ar[d]&{}\\
	{a_1e_1}\ar[d]&{a_5e_5}\ar[d]&{a_8e_8}\ar[d]&{a_{11}e_{11}}\ar[d]&{a_{13}e_{13}}\ar[d]\\
  {0}&{0}&{0}&{0}&{0}
}
\end{aligned}
\quad\stackrel{\varphi^2}{\longrightarrow}\quad
\begin{aligned}[c]
\xymatrix@R=15pt@C=10pt{
	{0e_4}\ar[d]&{0e_8}\ar[d]&{}&{}&{}\\
	{0e_3}\ar[d]&{0e_7}\ar[d]&{0e_{10}}\ar[d]&{}&{}\\
	{a_4e_2}\ar[d]&{a_8e_6}\ar[d]&{0e_9}\ar[d]&{0e_{12}}\ar[d]&{}\\
	{a_3e_1}\ar[d]&{a_7e_5}\ar[d]&{a_{10}e_8}\ar[d]&{0e_{11}}\ar[d]&{0e_{13}}\ar[d]\\
  {0}&{0}&{0}&{0}&{0}
}
\end{aligned}
\]
Как мы видим, остаются слагаемые вида коэффициент на какой-то базисный вектор.
Чтобы результат был нулем, надо чтобы все кооэффициенты оставшиеся справа на диаграмме были нулевые.
В данном примере, это означает, что на левой диаграмме верхние два слоя были нулями, то есть линейная комбинация принадлежит нижним двум слоям.
В общем случае ситуация такая же, ядро $\varphi^r$ будет порождено первыми $r$ слоями снизу.

Теперь нам надо посчитать количество клеток размера $r$ в жордановой форме.
Это соответствует тому, чтобы посчитать количество цепочек длины $r$ на большой диаграмме выше.
То есть нам надо посчитать количество векторов обведенных в овальную рамку в $r$-ой строке.
В начале посчитаем количество векторов в заштрихованной рамке на каждом этаже.
Так как $\ker \varphi^r$ порожден всеми векторами на слое $r$ и ниже, то в $r$-ой строке количество векторов в заштрихованной рамке равно $\dim \ker \varphi^r - \dim \ker \varphi^{r-1}$.
Тогда количество векторов в овальной рамке на этаже $r$ равно количество векторов в заштрихованной рамке на этаже $r$ минус количество векторов в заштрихованной рамке на этаже $r+1$.
Значит, искомое количество клеток размера $r$ равно:
\[
(\dim \ker \varphi^r - \dim \ker \varphi^{r-1}) - (\dim \ker \varphi^{r+1} - \dim \ker \varphi^r) = 2 \dim \ker \varphi^r - \dim \ker \varphi^{r+1} - \dim \ker \varphi^{r-1}
\]
\end{proof}

\paragraph{Замечания}

Отметим специальный вид для количества клеток максимального и минимального размеров и сделаем еще пару замечаний.
\begin{itemize}
\item Максимальный размер $r = k$.
Тогда как мы видим, количество клеток равно
\[
\dim \ker \varphi^k - \dim \ker \varphi^{k-1} = 
\dim V - \dim \ker \varphi^{k-1} = \dim \Im\varphi^{k-1}
\]
То есть ранг последней ненулевой степени оператора $\varphi$ -- это количество клеток максимальной размерности.

\item Минимальный размер $r = 1$.
Тогда $\ker \varphi^{r - 1} = 0$.
Значит, количество клеток размера $1$, то есть, количество отдельно стоящих нулей в жордановой форме будет
\[
2 \dim \ker \varphi - \dim \ker \varphi^{2} 
\]
Обратите внимание на то, что это НЕ размерность ядра.

\item Размерность ядра $\dim \ker \varphi$ -- это количество всех клеток всевозможных размеров.

\item Максимальный размер клетки -- это степень минимального многочлена для $\varphi$ или что то же самое -- кратность его единственного корня $0$.
\end{itemize}
